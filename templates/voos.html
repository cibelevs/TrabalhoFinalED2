<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta de Voos</title>

  <!-- Bootstrap & FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root {
      --laranja: #ff7b00;
      --laranja-escuro: #e56c00;
      --cinza-claro: #f7f7f7;
      --cinza-texto: #444;
    }

    body {
      background-color: var(--cinza-claro);
      font-family: "Segoe UI", sans-serif;
      color: var(--cinza-texto);
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
    }

    h2 {
      color: var(--laranja);
      font-weight: 700;
      margin: 0;
    }

    .table-custom {
      border-collapse: separate;
      border-spacing: 0 10px;
    }

    .table-custom thead th {
      background-color: var(--laranja);
      color: white;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }

    .table-custom tbody tr {
      background-color: white;
      transition: 0.3s;
    }

    .table-custom tbody tr:hover {
      background-color: #fff3e0;
    }

    .btn-laranja {
      background-color: var(--laranja);
      border: none;
      color: white;
      font-weight: 600;
      transition: 0.3s;
    }

    .btn-laranja:hover {
      background-color: var(--laranja-escuro);
      transform: scale(1.02);
    }

    .btn-warning {
      font-weight: 600;
    }

    .btn-danger {
      font-weight: 600;
    }

    .card {
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .edit-fields {
      display: none;
      gap: 5px;
      justify-content: center;
    }

    .edit-fields input {
      width: 80px;
      text-align: center;
    }

    .action-buttons {
      display: flex;
      gap: 5px;
      justify-content: center;
    }
  </style>
</head>
<body>
  <div class="container my-5">

    <!-- Header com título e botão de voltar -->
    <div class="header-top">
      <h2>Consulta de Voos</h2>
      <a href="{{ url_for('painel_admin') }}" class="btn btn-secondary">
        <i class="fa-solid fa-arrow-left me-1"></i> Voltar
      </a>
    </div>
    {% if passageiros_confirmados %}
    <div class="mt-4">

      <h4 class="text-center mb-3" style="color: var(--laranja);">
          Passageiros Confirmados
      </h4>

      <div class="row g-3">

        {% set total_geral = 0 %}

        {% for p in passageiros_confirmados %}
        {% set total_geral = total_geral + p.valor %}

        <div class="col-md-4">
          <div class="card p-3 shadow-sm" style="border-left: 5px solid var(--laranja);">
            <h5 class="mb-1">{{ p.nome }}</h5>
            <p class="mb-1"><strong>Tipo:</strong> {{ p.tipo }}</p>
            <p class="mb-1">
              <strong>Valor Total:</strong>
              R$ {{ "%.2f"|format(p.valor) }}
            </p>
          </div>
        </div>

        {% endfor %}

      </div>

      <div class="alert alert-warning text-center mt-4">
          <strong>Total Geral:</strong>
          R$ {{ "%.2f"|format(total_geral) }}
      </div>

    </div>
    {% endif %}

    <!-- Mensagens flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-4">
          {% for category, msg in messages %}
            <div class="alert alert-{{ 'danger' if category == 'erro' else 'success' }} alert-dismissible fade show" role="alert">
                {{ msg }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Formulário de busca -->
    <form method="get" class="row g-3 mb-4 justify-content-center">
      <div class="col-md-4">
        <input type="text" name="origem" class="form-control" placeholder="Origem" value="{{ origem }}">
      </div>
      <div class="col-md-4">
        <input type="text" name="destino" class="form-control" placeholder="Destino" value="{{ destino }}">
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-laranja w-100">
          <i class="fa-solid fa-magnifying-glass me-1"></i> Buscar
        </button>
      </div>
    </form>

    <!-- Tabela de voos -->
    {% if voos %}
    <div class="table-responsive card p-3">
      <table class="table table-custom text-center align-middle">
        <thead>
          <tr>
            <th>Código</th>
            <th>Data</th>
            <th>Horário</th>
            <th>Origem</th>
            <th>Destino</th>
            <th>Assentos</th>
            <th>Preço (R$)</th>
            <th>Ações</th>
          </tr>
        </thead>

        <tbody>
          {% for v in voos %}
          <tr>
            <td>{{ v.codigo }}</td>
            <td>{{ v.data }}</td>
            <td>{{ v.horario }}</td>
            <td>{{ v.origem }}</td>
            <td>{{ v.destino }}</td>
            <td>{{ v.assentos_totais }}</td>
            <td>{{ "%.2f"|format(v.preco) }}</td>
            <td class="action-buttons">
              <button class="btn btn-warning btn-sm btn-edit"
                      type="button"
                      data-bs-toggle="modal"
                      data-bs-target="#editModal"
                      data-codigo="{{ v.codigo }}"
                      data-data="{{ v.data }}"
                      data-horario="{{ v.horario }}"
                      data-origem="{{ v.origem }}"
                      data-destino="{{ v.destino }}"
                      data-assentos="{{ v.assentos_totais }}"
                      data-preco="{{ v.preco|float }}">
                <i class="fa-solid fa-pen-to-square"></i> Editar
              </button>

              <button class="btn btn-danger btn-sm btn-remove"
                      data-codigo="{{ v.codigo }}"
                      data-origem="{{ v.origem }}"
                      data-destino="{{ v.destino }}">
                <i class="fa-solid fa-trash"></i> Remover
              </button>
            </td>

        </tr>

          {% endfor %}
        </tbody>

        
      </table>
    </div>
    {% else %}
    <p class="text-center text-muted mt-3">Nenhum voo encontrado.</p>
    {% endif %}

  </div>

  <!-- Modal de edição -->
  <!-- Modal de edição -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <form method="post" action="{{ url_for('salvar_edicao') }}">
        <div class="modal-header bg-warning text-white">
          <h5 class="modal-title"><i class="fa-solid fa-pen-to-square me-2"></i> Editar Voo</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" name="codigo" id="editCodigo">

          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label small">Data</label>
              <input type="date" name="data" id="editData" class="form-control" required>
            </div>

            <div class="col-md-4">
              <label class="form-label small">Horário</label>
              <input type="time" name="horario" id="editHorario" class="form-control" required>
            </div>

            <div class="col-md-4">
              <label class="form-label small">Assentos</label>
              <input type="number" name="assentos_totais" id="editAssentos" class="form-control" min="1" required>
            </div>

            <div class="col-md-6">
              <label class="form-label small">Origem</label>
              <input type="text" name="origem" id="editOrigem" class="form-control" required>
            </div>

            <div class="col-md-6">
              <label class="form-label small">Destino</label>
              <input type="text" name="destino" id="editDestino" class="form-control" required>
            </div>

            <div class="col-md-4">
              <label class="form-label small">Preço (R$)</label>
              <input type="number" name="preco" id="editPreco" class="form-control" step="0.01" min="0" required>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-warning">Salvar Alterações</button>
        </div>
      </form>
    </div>
  </div>
</div>


  <!-- Modal de confirmação remoção -->
  <div class="modal fade" id="removeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title"><i class="fa-solid fa-triangle-exclamation me-2"></i> Confirmação</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body text-center" id="removeMessage"></div>
        <div class="modal-footer">
          <form method="post" action="{{ url_for('remover_voo') }}" id="removeForm">
            <input type="hidden" name="origem" id="removeOrigem">
            <input type="hidden" name="destino" id="removeDestino">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-danger">Sim, remover</button>
          </form>
        </div>
      </div>
    </div>
  </div>

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const editModal = new bootstrap.Modal(document.getElementById('editModal'));
        const removeModal = new bootstrap.Modal(document.getElementById('removeModal'));

        // --- BOTÃO EDITAR ---
        document.querySelectorAll('.btn-edit').forEach(btn => {
          btn.addEventListener('click', () => {

            document.getElementById('editCodigo').value = btn.dataset.codigo;
            document.getElementById('editData').value = btn.dataset.data;
            document.getElementById('editHorario').value = btn.dataset.horario;
            document.getElementById('editOrigem').value = btn.dataset.origem;
            document.getElementById('editDestino').value = btn.dataset.destino;
            document.getElementById('editAssentos').value = btn.dataset.assentos_totais;
            document.getElementById('editPreco').value = btn.dataset.preco;

            editModal.show();
          });
        });

        // --- BOTÃO REMOVER ---
        document.querySelectorAll('.btn-remove').forEach(btn => {
          btn.addEventListener('click', () => {
            document.getElementById('removeOrigem').value = btn.dataset.origem;
            document.getElementById('removeDestino').value = btn.dataset.destino;

            document.getElementById('removeMessage').innerHTML = `
              <p class="mb-2">Tem certeza que deseja remover o voo abaixo?</p>
              <p><strong>Origem:</strong> ${btn.dataset.origem}</p>
              <p><strong>Destino:</strong> ${btn.dataset.destino}</p>
            `;

            removeModal.show();
          });
        });


        {% if abrir_modal %}
 
        const editModal = new bootstrap.Modal(document.getElementById('editModal'));

        document.getElementById('editCodigo').value = "{{ voo_atual.codigo }}";
        document.getElementById('editData').value = "{{ voo_atual.data }}";
        document.getElementById('editHorario').value = "{{ voo_atual.horario }}";
        document.getElementById('editOrigem').value = "{{ voo_atual.origem }}";
        document.getElementById('editDestino').value = "{{ voo_atual.destino }}";
        document.getElementById('editAssentos').value = "{{ voo_atual.assentos_totais }}";
        document.getElementById('editPreco').value = "{{ voo_atual.preco }}";

        editModal.show();
    {% endif %}

    </script>
    
</body>
</html>
